# 命令/请求执行结果展示改进

## 概述

本次改进优化了命令执行和 REST API 请求的错误信息展示,确保错误信息能直接在界面上显示,并提供便捷的复制功能。

## 改进内容

### 1. CommandResult 组件 (`src/components/CommandResult.tsx`)

#### 错误信息展示
- ✅ 错误信息在 Markdown 中清晰展示
- ✅ 使用 `❌ 命令执行失败` 标题
- ✅ 显示完整的错误堆栈和信息

#### 复制 Action 优化
改进前:
- 只有标准输出和标准错误的复制选项
- 错误信息无法直接复制

改进后:
- **失败时优先显示**: `⌘E` 复制错误信息
- **成功时优先显示**: `⌘C` 复制标准输出
- **通用操作**:
  - `⌘L` 复制完整命令
  - `⌘⇧L` 复制命令行路径
  - `⌘⇧E` 复制标准错误(如果有)

#### 快捷键布局
| 操作 | 成功时 | 失败时 |
|------|--------|--------|
| 主要操作 | `⌘C` 复制标准输出 | `⌘E` 复制错误信息 |
| 命令相关 | `⌘L` 复制完整命令 | `⌘L` 复制完整命令 |
| 次要操作 | `⌘⇧L` 复制命令路径 | `⌘⇧L` 复制命令路径 |
| 调试信息 | - | `⌘⇧E` 复制标准错误 |

### 2. RequestResult 组件 (`src/components/RequestResult.tsx`)

#### 错误信息展示
- ✅ 错误信息在 Markdown 中清晰展示
- ✅ 使用 `❌ 请求失败` 标题
- ✅ 显示 HTTP 状态码和错误详情

#### 复制 Action 优化
改进前:
- 错误信息复制快捷键为 `⌘⇧C`,优先级低

改进后:
- **失败时优先显示**: `⌘E` 复制错误信息
- **成功时优先显示**: `⌘C` 复制响应数据
- **通用操作**:
  - `⌘U` 复制 URL
  - `⌘V` 粘贴响应数据(成功时)
  - `⌘⇧A` 复制完整结果

#### 快捷键布局
| 操作 | 成功时 | 失败时 |
|------|--------|--------|
| 主要操作 | `⌘C` 复制响应数据 | `⌘E` 复制错误信息 |
| URL | `⌘U` 复制 URL | `⌘U` 复制 URL |
| 粘贴 | `⌘V` 粘贴数据 | - |
| 完整结果 | `⌘⇧A` 复制全部 | `⌘⇧A` 复制全部 |

## 用户体验改进

### 1. 上下文感知的 Action 顺序
- 失败时,错误信息相关的 Action 排在最前面
- 成功时,输出数据相关的 Action 排在最前面
- 用户最需要的操作总是在第一位

### 2. 一致的快捷键设计
- `⌘E` 统一用于复制错误信息(Error)
- `⌘C` 统一用于复制主要内容(Content)
- `⌘L` 用于复制命令行(Line/Command)
- `⌘U` 用于复制 URL

### 3. 智能提示
- Metadata 中的提示根据成功/失败状态动态变化
- 成功时提示: "⌘C 复制输出 | ⌘L 复制命令"
- 失败时提示: "⌘E 复制错误 | ⌘L 复制命令"

## 使用示例

### 命令执行失败场景

1. 用户执行一个会失败的命令
2. 系统显示 `❌ 命令执行失败` 页面
3. 错误信息清晰展示在 Markdown 中
4. 用户可以:
   - 按 `⌘E` 快速复制错误信息用于调试
   - 按 `⌘L` 复制完整命令以便在终端重试
   - 按 `⌘⇧L` 复制命令路径
   - 查看 Metadata 了解详细状态

### REST API 请求失败场景

1. 用户执行一个会失败的 API 请求
2. 系统显示 `❌ 请求失败` 页面
3. 错误信息和 HTTP 状态码清晰展示
4. 用户可以:
   - 按 `⌘E` 快速复制错误信息
   - 按 `⌘U` 复制 URL 用于测试
   - 按 `⌘⇧A` 复制完整结果报告问题

## 技术实现

### Action 优先级控制
```typescript
{/* 错误信息复制 - 失败时优先显示 */}
{!success && error && (
  <Action.CopyToClipboard
    title="复制错误信息"
    content={error}
    icon={Icon.ExclamationMark}
    shortcut={{ modifiers: ["cmd"], key: "e" }}
  />
)}
{/* 标准输出复制 - 成功时优先显示 */}
{success && stdout && stdout.trim() && (
  <Action.CopyToClipboard
    title="复制标准输出"
    content={stdout}
    icon={Icon.Text}
    shortcut={{ modifiers: ["cmd"], key: "c" }}
  />
)}
```

### 动态提示信息
```typescript
<Detail.Metadata.Label
  title="💡 提示"
  text={
    success
      ? "⌘C 复制输出 | ⌘L 复制命令"
      : "⌘E 复制错误 | ⌘L 复制命令"
  }
/>
```

## 相关文件

- `src/components/CommandResult.tsx` - 命令执行结果展示组件
- `src/components/RequestResult.tsx` - REST API 请求结果展示组件
- `src/components/PromptForm.tsx` - 表单组件,负责执行命令并切换到结果页面

## 测试建议

1. **命令执行成功**:
   - 执行 `/opt/Notes/Prompts/exec/cc-usage-view.md`
   - 验证输出正确显示
   - 测试 `⌘C` 复制输出

2. **命令执行失败**:
   - 创建一个会失败的命令配置
   - 验证错误信息清晰展示
   - 测试 `⌘E` 复制错误信息

3. **API 请求成功**:
   - 执行一个成功的 API 请求
   - 验证响应数据正确展示
   - 测试 `⌘C` 复制数据

4. **API 请求失败**:
   - 执行一个会失败的 API 请求
   - 验证错误信息清晰展示
   - 测试 `⌘E` 复制错误信息

## 版本历史

- **v1.0** (2024-12-19): 初始实现错误信息展示和复制功能
